server {
    listen       ${PORT};
    listen  [::]:${PORT};
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    
        try_files $uri $uri/ /index.html;
        if ($request_method = POST) {
          return 405;
        }
        if (!-e $request_filename){
          rewrite ^(.*)$ /index.html break;
        }

    }

    client_body_timeout 5s;
    client_header_timeout 5s;

    gzip off;
    # gzip_http_version 1.1;
    # gzip_disable      "MSIE [1-6]\.";
    # gzip_min_length   256;
    # gzip_vary         on;
    # gzip_proxied      expired no-cache no-store private auth;
    # gzip_types        text/plain text/css application/json application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript;
    # gzip_comp_level   9;

    # security headers
    add_header Access-Control-Allow-Origin *;
    add_header X-XSS-Protection        "1; mode=block" always;
    add_header X-Content-Type-Options  "nosniff" always;
    add_header Referrer-Policy         "no-referrer" always;
    add_header Permissions-Policy      "interest-cohort=()" always;
    add_header Pragma: no-cache;

    # default dev's environment
    set $envtmp ${ENVIRONMENT};
    set $ContentSecurityPolicy "default-src 'self'; script-src 'report-sample' 'self' https://assets.adobedtm.com/6279662c4fd9/84234ffe374b/launch-711355612fde-development.min.js https://bat.bing.com/bat.js https://connect.facebook.net/en_US/fbevents.js https://go.botmaker.com/rest/webchat/p/XYPMTIZTM1/init.js https://polyfill.io/v3/polyfill.min.js https://storage.googleapis.com/botmaker/webchat2/50484/static/js/main.b2f37e3e.js https://www.clarity.ms/tag/uet/343093405 https://www.google-analytics.com/analytics.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://analytics.google.com https://go.botmaker.com https://m-infra.appspot.com https://metlifeglobal.tt.omtrdc.net https://stats.g.doubleclick.net https://storage.googleapis.com https://tramites.ingress.api.dev.metlife.cl https://www.google-analytics.com wss://ws.botmaker.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; frame-src 'self'; img-src 'self' data: https://bat.bing.com https://metlife.sc.omtrdc.net https://storage.googleapis.com https://www.google.com https://www.google.com.co; manifest-src 'self'; media-src 'self' https://storage.googleapis.com; worker-src blob:;";

    if ($envtmp = "int") {
      set $ContentSecurityPolicy "default-src 'self'; script-src 'report-sample' 'self' https://assets.adobedtm.com/6279662c4fd9/84234ffe374b/launch-711355612fde-development.min.js https://bat.bing.com/bat.js https://connect.facebook.net/en_US/fbevents.js https://go.botmaker.com/rest/webchat/p/XYPMTIZTM1/init.js https://polyfill.io/v3/polyfill.min.js https://storage.googleapis.com/botmaker/webchat2/50484/static/js/main.b2f37e3e.js https://www.clarity.ms/tag/uet/343093405 https://www.google-analytics.com/analytics.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://analytics.google.com https://go.botmaker.com https://m-infra.appspot.com https://metlifeglobal.tt.omtrdc.net https://stats.g.doubleclick.net https://storage.googleapis.com https://tramites.ingress.api.qa.metlife.cl https://www.google-analytics.com wss://ws.botmaker.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; frame-src 'self'; img-src 'self' data: https://bat.bing.com https://metlife.sc.omtrdc.net https://storage.googleapis.com https://www.google.com https://www.google.com.co; manifest-src 'self'; media-src 'self' https://storage.googleapis.com; worker-src blob:;";
    }

    if ($envtmp = "qa") {
      set $ContentSecurityPolicy "default-src 'self'; script-src 'report-sample' 'self' https://assets.adobedtm.com/6279662c4fd9/84234ffe374b/launch-711355612fde-development.min.js https://bat.bing.com/bat.js https://connect.facebook.net/en_US/fbevents.js https://go.botmaker.com/rest/webchat/p/XYPMTIZTM1/init.js https://polyfill.io/v3/polyfill.min.js https://storage.googleapis.com/botmaker/webchat2/50484/static/js/main.b2f37e3e.js https://www.clarity.ms/tag/uet/343093405 https://www.google-analytics.com/analytics.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://analytics.google.com https://go.botmaker.com https://m-infra.appspot.com https://metlifeglobal.tt.omtrdc.net https://stats.g.doubleclick.net https://storage.googleapis.com https://tramites.ingress.api.qa.metlife.cl https://www.google-analytics.com wss://ws.botmaker.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; frame-src 'self'; img-src 'self' data: https://bat.bing.com https://metlife.sc.omtrdc.net https://storage.googleapis.com https://www.google.com https://www.google.com.co; manifest-src 'self'; media-src 'self' https://storage.googleapis.com; worker-src blob:;";
    }

    if ($envtmp = "prod") {
      set $ContentSecurityPolicy "default-src 'self'; script-src 'report-sample' 'self' https://assets.adobedtm.com/6279662c4fd9/84234ffe374b/launch-711355612fde-development.min.js https://bat.bing.com/bat.js https://connect.facebook.net/en_US/fbevents.js https://go.botmaker.com/rest/webchat/p/XYPMTIZTM1/init.js https://polyfill.io/v3/polyfill.min.js https://storage.googleapis.com/botmaker/webchat2/50484/static/js/main.b2f37e3e.js https://www.clarity.ms/tag/uet/343093405 https://www.google-analytics.com/analytics.js https://www.googletagmanager.com/gtag/js; style-src 'report-sample' 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com; object-src 'none'; base-uri 'self'; connect-src 'self' https://analytics.google.com https://go.botmaker.com https://m-infra.appspot.com https://metlifeglobal.tt.omtrdc.net https://stats.g.doubleclick.net https://storage.googleapis.com https://tramites.ingress.api.prod.metlife.cl https://www.google-analytics.com wss://ws.botmaker.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; frame-src 'self'; img-src 'self' data: https://bat.bing.com https://metlife.sc.omtrdc.net https://storage.googleapis.com https://www.google.com https://www.google.com.co; manifest-src 'self'; media-src 'self' https://storage.googleapis.com; worker-src blob:;";
    }

    # add_header Content-Security-Policy $ContentSecurityPolicy always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'; frame-ancestors 'self';" always;

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
